<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Validation & Fix Loop - Live Dashboard</title>
  <style>
    :root {
      --primary: #667eea;
      --secondary: #764ba2;
      --success: #4caf50;
      --warning: #ff9800;
      --danger: #f44336;
      --info: #2196f3;
      --dark: #333;
      --light: #f5f5f5;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: var(--light);
      color: var(--dark);
      overflow-x: hidden;
    }

    .dashboard-container {
      display: grid;
      grid-template-columns: 250px 1fr;
      grid-template-rows: 60px 1fr;
      height: 100vh;
    }

    /* Top Bar */
    .top-bar {
      grid-column: 1 / -1;
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 0 20px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }

    .logo {
      font-size: 1.2rem;
      font-weight: 700;
    }

    .status-indicator {
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .status-dot {
      width: 10px;
      height: 10px;
      border-radius: 50%;
      background: var(--success);
      animation: pulse 2s infinite;
    }

    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.5; }
    }

    /* Sidebar */
    .sidebar {
      background: white;
      border-right: 1px solid #e0e0e0;
      padding: 20px 0;
      overflow-y: auto;
    }

    .nav-item {
      padding: 12px 20px;
      cursor: pointer;
      border-left: 3px solid transparent;
      transition: all 0.2s;
    }

    .nav-item:hover {
      background: var(--light);
    }

    .nav-item.active {
      border-left-color: var(--primary);
      background: #f0f4ff;
      color: var(--primary);
      font-weight: 600;
    }

    .nav-item i {
      margin-right: 10px;
      width: 16px;
    }

    /* Main Content */
    .main-content {
      padding: 20px;
      overflow-y: auto;
    }

    .page {
      display: none;
    }

    .page.active {
      display: block;
    }

    /* Metrics Cards */
    .metrics-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
      gap: 20px;
      margin-bottom: 30px;
    }

    .metric-card {
      background: white;
      padding: 20px;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      border-left: 4px solid var(--primary);
    }

    .metric-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
      margin-bottom: 5px;
    }

    .metric-label {
      font-size: 0.9rem;
      color: #666;
      text-transform: uppercase;
      font-weight: 500;
    }

    .metric-change {
      font-size: 0.8rem;
      margin-top: 5px;
    }

    .metric-change.positive {
      color: var(--success);
    }

    .metric-change.negative {
      color: var(--danger);
    }

    /* Charts */
    .chart-container {
      background: white;
      border-radius: 8px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .chart-title {
      font-size: 1.2rem;
      font-weight: 600;
      margin-bottom: 15px;
    }

    .chart-placeholder {
      height: 300px;
      background: var(--light);
      border-radius: 4px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: #666;
      font-style: italic;
    }

    /* Activity Feed */
    .activity-feed {
      background: white;
      border-radius: 8px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
      max-height: 400px;
      overflow-y: auto;
    }

    .activity-item {
      display: flex;
      align-items: start;
      gap: 15px;
      padding: 10px 0;
      border-bottom: 1px solid #f0f0f0;
    }

    .activity-item:last-child {
      border-bottom: none;
    }

    .activity-icon {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 0.8rem;
      color: white;
      flex-shrink: 0;
    }

    .activity-icon.error {
      background: var(--danger);
    }

    .activity-icon.fix {
      background: var(--success);
    }

    .activity-icon.iteration {
      background: var(--info);
    }

    .activity-content {
      flex-grow: 1;
    }

    .activity-title {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .activity-details {
      font-size: 0.9rem;
      color: #666;
    }

    .activity-time {
      font-size: 0.8rem;
      color: #999;
      margin-top: 2px;
    }

    /* Error List */
    .error-list {
      background: white;
      border-radius: 8px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    }

    .error-item {
      padding: 15px 20px;
      border-bottom: 1px solid #f0f0f0;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .error-item:last-child {
      border-bottom: none;
    }

    .error-details {
      flex-grow: 1;
    }

    .error-type {
      font-weight: 600;
      margin-bottom: 2px;
    }

    .error-message {
      font-size: 0.9rem;
      color: #666;
      margin-bottom: 2px;
    }

    .error-meta {
      font-size: 0.8rem;
      color: #999;
    }

    .error-severity {
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 600;
      text-transform: uppercase;
    }

    .severity-critical {
      background: var(--danger);
      color: white;
    }

    .severity-high {
      background: #ff6b6b;
      color: white;
    }

    .severity-medium {
      background: var(--warning);
      color: white;
    }

    .severity-low {
      background: #6c757d;
      color: white;
    }

    /* Progress Bars */
    .progress-container {
      margin: 15px 0;
    }

    .progress-bar {
      width: 100%;
      height: 20px;
      background: #e0e0e0;
      border-radius: 10px;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, var(--success), #8bc34a);
      transition: width 0.8s ease;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 0.8rem;
    }

    /* Controls */
    .controls {
      display: flex;
      gap: 10px;
      margin-bottom: 20px;
    }

    .btn {
      padding: 8px 16px;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      font-size: 0.9rem;
      font-weight: 500;
      transition: all 0.2s;
    }

    .btn-primary {
      background: var(--primary);
      color: white;
    }

    .btn-primary:hover {
      background: #5a73e7;
    }

    .btn-secondary {
      background: #e0e0e0;
      color: var(--dark);
    }

    .btn-secondary:hover {
      background: #d0d0d0;
    }

    /* Auto-refresh indicator */
    .auto-refresh {
      position: fixed;
      bottom: 20px;
      right: 20px;
      background: var(--success);
      color: white;
      padding: 10px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      display: flex;
      align-items: center;
      gap: 8px;
      z-index: 1000;
    }

    .refresh-dot {
      width: 8px;
      height: 8px;
      background: white;
      border-radius: 50%;
      animation: pulse 1.5s infinite;
    }

    /* Responsive */
    @media (max-width: 768px) {
      .dashboard-container {
        grid-template-columns: 1fr;
        grid-template-rows: 60px 50px 1fr;
      }

      .sidebar {
        grid-row: 2;
        display: flex;
        overflow-x: auto;
        padding: 10px 0;
        border-bottom: 1px solid #e0e0e0;
        border-right: none;
      }

      .nav-item {
        white-space: nowrap;
        border-left: none;
        border-bottom: 3px solid transparent;
      }

      .nav-item.active {
        border-left: none;
        border-bottom-color: var(--primary);
      }

      .metrics-grid {
        grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      }
    }
  </style>
</head>
<body>
  <div class="dashboard-container">
    <!-- Top Bar -->
    <div class="top-bar">
      <div class="logo">üöÄ Validation Dashboard</div>
      <div class="status-indicator">
        <div class="status-dot"></div>
        <span id="connection-status">Connected</span>
        <span id="session-id">Session: Loading...</span>
      </div>
    </div>

    <!-- Sidebar Navigation -->
    <div class="sidebar">
      <div class="nav-item active" onclick="showPage('overview')">
        <i>üìä</i> Overview
      </div>
      <div class="nav-item" onclick="showPage('errors')">
        <i>‚ö†Ô∏è</i> Errors
      </div>
      <div class="nav-item" onclick="showPage('performance')">
        <i>‚ö°</i> Performance
      </div>
      <div class="nav-item" onclick="showPage('trends')">
        <i>üìà</i> Trends
      </div>
      <div class="nav-item" onclick="showPage('activity')">
        <i>üìù</i> Activity
      </div>
      <div class="nav-item" onclick="showPage('settings')">
        <i>‚öôÔ∏è</i> Settings
      </div>
    </div>

    <!-- Main Content -->
    <div class="main-content">
      <!-- Overview Page -->
      <div id="overview" class="page active">
        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-value" id="total-iterations">0</div>
            <div class="metric-label">Total Iterations</div>
            <div class="metric-change" id="iterations-change"></div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="total-errors">0</div>
            <div class="metric-label">Total Errors</div>
            <div class="metric-change" id="errors-change"></div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="fixed-errors">0</div>
            <div class="metric-label">Fixed Errors</div>
            <div class="metric-change" id="fixed-change"></div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="fix-success-rate">0%</div>
            <div class="metric-label">Fix Success Rate</div>
            <div class="metric-change" id="success-rate-change"></div>
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-title">Progress Overview</div>
          <div class="progress-container">
            <div class="progress-bar">
              <div class="progress-fill" id="overall-progress" style="width: 0%">
                0 / 0 Fixed
              </div>
            </div>
          </div>
          <div class="chart-placeholder" id="progress-chart">
            Live progress chart will be displayed here
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-title">Recent Activity</div>
          <div class="activity-feed" id="recent-activity">
            <div class="activity-item">
              <div class="activity-icon iteration">i</div>
              <div class="activity-content">
                <div class="activity-title">Dashboard Initialized</div>
                <div class="activity-details">Waiting for validation loop to start...</div>
                <div class="activity-time">Just now</div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Errors Page -->
      <div id="errors" class="page">
        <div class="controls">
          <button class="btn btn-primary" onclick="refreshErrors()">Refresh</button>
          <button class="btn btn-secondary" onclick="exportErrors()">Export</button>
        </div>

        <div class="error-list" id="error-list">
          <div class="error-item">
            <div class="error-details">
              <div class="error-type">No errors detected yet</div>
              <div class="error-message">Waiting for validation loop to start...</div>
              <div class="error-meta">Component: system | Status: waiting</div>
            </div>
            <div class="error-severity severity-low">info</div>
          </div>
        </div>
      </div>

      <!-- Performance Page -->
      <div id="performance" class="page">
        <div class="metrics-grid">
          <div class="metric-card">
            <div class="metric-value" id="avg-iteration-time">0ms</div>
            <div class="metric-label">Avg Iteration Time</div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="memory-usage">0MB</div>
            <div class="metric-label">Memory Usage</div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="convergence-rate">0%</div>
            <div class="metric-label">Convergence Rate</div>
          </div>
          <div class="metric-card">
            <div class="metric-value" id="error-density">0.0</div>
            <div class="metric-label">Error Density</div>
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-title">Performance Trends</div>
          <div class="chart-placeholder">
            Real-time performance charts will be displayed here
          </div>
        </div>
      </div>

      <!-- Trends Page -->
      <div id="trends" class="page">
        <div class="chart-container">
          <div class="chart-title">Error Trends</div>
          <div class="chart-placeholder">
            Historical error trend analysis
          </div>
        </div>

        <div class="chart-container">
          <div class="chart-title">Fix Effectiveness</div>
          <div class="chart-placeholder">
            Fix success rate over time
          </div>
        </div>
      </div>

      <!-- Activity Page -->
      <div id="activity" class="page">
        <div class="activity-feed" id="full-activity">
          <div class="activity-item">
            <div class="activity-icon iteration">üìä</div>
            <div class="activity-content">
              <div class="activity-title">Dashboard Started</div>
              <div class="activity-details">Real-time monitoring initialized</div>
              <div class="activity-time">Just now</div>
            </div>
          </div>
        </div>
      </div>

      <!-- Settings Page -->
      <div id="settings" class="page">
        <div class="chart-container">
          <div class="chart-title">Dashboard Settings</div>
          <div style="padding: 20px;">
            <label>
              <input type="checkbox" id="auto-refresh" checked>
              Enable auto-refresh (30 seconds)
            </label>
            <br><br>
            <label>
              <input type="checkbox" id="notifications" checked>
              Enable notifications
            </label>
            <br><br>
            <label>
              Refresh interval:
              <select id="refresh-interval">
                <option value="10">10 seconds</option>
                <option value="30" selected>30 seconds</option>
                <option value="60">1 minute</option>
                <option value="300">5 minutes</option>
              </select>
            </label>
            <br><br>
            <button class="btn btn-primary" onclick="applySettings()">Apply Settings</button>
            <button class="btn btn-secondary" onclick="resetSettings()">Reset to Defaults</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Auto-refresh indicator -->
  <div class="auto-refresh" id="auto-refresh-indicator">
    <div class="refresh-dot"></div>
    Live Updates Active
  </div>

  <script>
    // Dashboard State
    let dashboardState = {
      sessionId: null,
      connected: true,
      autoRefresh: true,
      refreshInterval: 30000,
      lastUpdate: null,
      metrics: {
        totalIterations: 0,
        totalErrors: 0,
        fixedErrors: 0,
        fixSuccessRate: 0,
        avgIterationTime: 0,
        memoryUsage: 0,
        convergenceRate: 0,
        errorDensity: 0
      },
      activity: [],
      errors: []
    };

    // Navigation
    function showPage(pageId) {
      // Hide all pages
      document.querySelectorAll('.page').forEach(page => {
        page.classList.remove('active');
      });

      // Remove active class from all nav items
      document.querySelectorAll('.nav-item').forEach(item => {
        item.classList.remove('active');
      });

      // Show selected page
      document.getElementById(pageId).classList.add('active');

      // Add active class to selected nav item
      event.target.classList.add('active');

      console.log(`Switched to ${pageId} page`);
    }

    // Update dashboard metrics
    function updateMetrics(data) {
      if (data.metrics) {
        dashboardState.metrics = { ...dashboardState.metrics, ...data.metrics };

        // Update metric displays
        document.getElementById('total-iterations').textContent = data.metrics.totalIterations || 0;
        document.getElementById('total-errors').textContent = data.metrics.totalErrors || 0;
        document.getElementById('fixed-errors').textContent = data.metrics.fixedErrors || 0;
        document.getElementById('fix-success-rate').textContent = (data.metrics.fixSuccessRate || 0) + '%';
        document.getElementById('avg-iteration-time').textContent = Math.round(data.metrics.avgIterationTime || 0) + 'ms';
        document.getElementById('memory-usage').textContent = Math.round((data.metrics.avgMemoryUsage || 0) / 1024 / 1024) + 'MB';
        document.getElementById('convergence-rate').textContent = (data.metrics.convergenceRate || 0) + '%';
        document.getElementById('error-density').textContent = (data.metrics.errorDensity || 0).toFixed(1);

        // Update progress bar
        const totalErrors = data.metrics.totalErrors || 0;
        const fixedErrors = data.metrics.fixedErrors || 0;
        const progressPercent = totalErrors > 0 ? (fixedErrors / totalErrors * 100) : 0;

        const progressBar = document.getElementById('overall-progress');
        progressBar.style.width = progressPercent + '%';
        progressBar.textContent = `${fixedErrors} / ${totalErrors} Fixed`;
      }
    }

    // Add activity item
    function addActivity(type, title, details) {
      const activity = {
        type,
        title,
        details,
        timestamp: Date.now()
      };

      dashboardState.activity.unshift(activity);

      // Keep only last 50 activities
      if (dashboardState.activity.length > 50) {
        dashboardState.activity = dashboardState.activity.slice(0, 50);
      }

      updateActivityDisplay();
    }

    // Update activity display
    function updateActivityDisplay() {
      const recentActivity = document.getElementById('recent-activity');
      const fullActivity = document.getElementById('full-activity');

      const activityHTML = dashboardState.activity.slice(0, 10).map(activity => {
        const timeAgo = getTimeAgo(activity.timestamp);
        const iconClass = activity.type === 'error' ? 'error' : activity.type === 'fix' ? 'fix' : 'iteration';
        const icon = activity.type === 'error' ? '‚ö†Ô∏è' : activity.type === 'fix' ? '‚úÖ' : 'üìä';

        return `
          <div class="activity-item">
            <div class="activity-icon ${iconClass}">${icon}</div>
            <div class="activity-content">
              <div class="activity-title">${activity.title}</div>
              <div class="activity-details">${activity.details}</div>
              <div class="activity-time">${timeAgo}</div>
            </div>
          </div>
        `;
      }).join('');

      recentActivity.innerHTML = activityHTML;
      fullActivity.innerHTML = dashboardState.activity.map(activity => {
        const timeAgo = getTimeAgo(activity.timestamp);
        const iconClass = activity.type === 'error' ? 'error' : activity.type === 'fix' ? 'fix' : 'iteration';
        const icon = activity.type === 'error' ? '‚ö†Ô∏è' : activity.type === 'fix' ? '‚úÖ' : 'üìä';

        return `
          <div class="activity-item">
            <div class="activity-icon ${iconClass}">${icon}</div>
            <div class="activity-content">
              <div class="activity-title">${activity.title}</div>
              <div class="activity-details">${activity.details}</div>
              <div class="activity-time">${timeAgo}</div>
            </div>
          </div>
        `;
      }).join('');
    }

    // Update error list
    function updateErrorList(errors) {
      dashboardState.errors = errors || [];

      const errorList = document.getElementById('error-list');

      if (errors && errors.length > 0) {
        errorList.innerHTML = errors.map(error => `
          <div class="error-item">
            <div class="error-details">
              <div class="error-type">${error.type || 'Unknown Error'}</div>
              <div class="error-message">${error.message || 'No message'}</div>
              <div class="error-meta">
                Component: ${error.component || 'unknown'} |
                Status: ${error.status || 'pending'} |
                ${getTimeAgo(error.timestamp)}
              </div>
            </div>
            <div class="error-severity severity-${(error.severity || 'low').toLowerCase()}">
              ${error.severity || 'LOW'}
            </div>
          </div>
        `).join('');
      } else {
        errorList.innerHTML = `
          <div class="error-item">
            <div class="error-details">
              <div class="error-type">No errors detected</div>
              <div class="error-message">System is running clean!</div>
              <div class="error-meta">Component: system | Status: healthy</div>
            </div>
            <div class="error-severity severity-low">INFO</div>
          </div>
        `;
      }
    }

    // Simulate real-time updates (in a real implementation, this would connect to a WebSocket or polling endpoint)
    function simulateRealTimeUpdate() {
      // Simulate some activity
      const activities = [
        { type: 'iteration', title: 'Iteration Completed', details: 'Found 3 errors, applied 2 fixes' },
        { type: 'error', title: 'New Error Detected', details: 'TypeError in character-creation component' },
        { type: 'fix', title: 'Fix Applied', details: 'Successfully resolved save-system error' }
      ];

      const randomActivity = activities[Math.floor(Math.random() * activities.length)];
      addActivity(randomActivity.type, randomActivity.title, randomActivity.details);

      // Update metrics with some variation
      dashboardState.metrics.totalIterations += Math.floor(Math.random() * 2);
      dashboardState.metrics.totalErrors += Math.floor(Math.random() * 3);
      dashboardState.metrics.fixedErrors += Math.floor(Math.random() * 2);

      if (dashboardState.metrics.totalErrors > 0) {
        dashboardState.metrics.fixSuccessRate = Math.round(
          (dashboardState.metrics.fixedErrors / dashboardState.metrics.totalErrors) * 100
        );
      }

      updateMetrics({ metrics: dashboardState.metrics });
    }

    // Utility functions
    function getTimeAgo(timestamp) {
      const now = Date.now();
      const diff = now - timestamp;
      const minutes = Math.floor(diff / 60000);
      const hours = Math.floor(diff / 3600000);

      if (hours > 0) return `${hours}h ago`;
      if (minutes > 0) return `${minutes}m ago`;
      return 'Just now';
    }

    function refreshErrors() {
      console.log('Refreshing error list...');
      // In a real implementation, this would fetch fresh data
    }

    function exportErrors() {
      console.log('Exporting error data...');
      // In a real implementation, this would trigger an export
    }

    function applySettings() {
      dashboardState.autoRefresh = document.getElementById('auto-refresh').checked;
      dashboardState.refreshInterval = parseInt(document.getElementById('refresh-interval').value) * 1000;

      console.log('Settings applied:', {
        autoRefresh: dashboardState.autoRefresh,
        refreshInterval: dashboardState.refreshInterval
      });

      if (dashboardState.autoRefresh) {
        startAutoRefresh();
      } else {
        stopAutoRefresh();
      }
    }

    function resetSettings() {
      document.getElementById('auto-refresh').checked = true;
      document.getElementById('notifications').checked = true;
      document.getElementById('refresh-interval').value = '30';
      applySettings();
    }

    function startAutoRefresh() {
      if (window.refreshTimer) {
        clearInterval(window.refreshTimer);
      }

      window.refreshTimer = setInterval(() => {
        if (dashboardState.autoRefresh) {
          simulateRealTimeUpdate();
        }
      }, dashboardState.refreshInterval);

      document.getElementById('auto-refresh-indicator').style.display = 'flex';
    }

    function stopAutoRefresh() {
      if (window.refreshTimer) {
        clearInterval(window.refreshTimer);
      }
      document.getElementById('auto-refresh-indicator').style.display = 'none';
    }

    // Initialize dashboard
    function initializeDashboard() {
      console.log('üöÄ Validation Dashboard initialized');

      // Set session ID
      dashboardState.sessionId = `session_${Date.now()}`;
      document.getElementById('session-id').textContent = `Session: ${dashboardState.sessionId}`;

      // Add initial activity
      addActivity('iteration', 'Dashboard Initialized', 'Real-time monitoring started');

      // Start auto-refresh if enabled
      if (dashboardState.autoRefresh) {
        startAutoRefresh();
      }

      // Update displays
      updateMetrics({ metrics: dashboardState.metrics });
      updateErrorList([]);
    }

    // Event listeners
    document.addEventListener('DOMContentLoaded', initializeDashboard);

    // Keyboard shortcuts
    document.addEventListener('keydown', function(e) {
      if (e.altKey) {
        switch(e.key) {
          case '1': showPage('overview'); break;
          case '2': showPage('errors'); break;
          case '3': showPage('performance'); break;
          case '4': showPage('trends'); break;
          case '5': showPage('activity'); break;
          case '6': showPage('settings'); break;
        }
      }
    });

    // Export dashboard state for debugging
    window.dashboardState = dashboardState;
    window.addActivity = addActivity;
    window.updateMetrics = updateMetrics;
    window.updateErrorList = updateErrorList;

    console.log('Dashboard ready! Use Alt+1-6 for navigation shortcuts');
  </script>
</body>
</html>