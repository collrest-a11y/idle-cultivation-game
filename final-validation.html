<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Final Game Validation</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: #1a1a1a;
            color: #e0e0e0;
            margin: 0;
            padding: 20px;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #4CAF50;
            text-align: center;
            border-bottom: 2px solid #4CAF50;
            padding-bottom: 10px;
        }
        .test-section {
            background: #2a2a2a;
            border-radius: 8px;
            padding: 20px;
            margin: 20px 0;
            border-left: 4px solid #4CAF50;
        }
        .test-section.error {
            border-left-color: #f44336;
        }
        .test-section.warning {
            border-left-color: #ff9800;
        }
        .test-result {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px;
            margin: 5px 0;
            background: #1a1a1a;
            border-radius: 4px;
        }
        .success { color: #4CAF50; }
        .error { color: #f44336; }
        .warning { color: #ff9800; }
        .info { color: #2196F3; }

        .status-icon {
            font-size: 20px;
            margin-right: 10px;
        }

        button {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            margin: 5px;
        }
        button:hover {
            background: #45a049;
        }

        .game-frame {
            width: 100%;
            height: 600px;
            border: 2px solid #4CAF50;
            border-radius: 8px;
            margin: 20px 0;
        }

        .summary {
            background: #2a2a2a;
            padding: 20px;
            border-radius: 8px;
            margin-top: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #1a1a1a;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #f44336 0%, #ff9800 50%, #4CAF50 100%);
            transition: width 0.3s ease;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéÆ Idle Cultivation Game - Final Validation Report</h1>

        <div class="test-section">
            <h2>üìä Overall Status</h2>
            <div class="progress-bar">
                <div class="progress-fill" id="overall-progress" style="width: 0%">
                    <span id="progress-text">0%</span>
                </div>
            </div>
            <div id="summary-stats"></div>
        </div>

        <div class="test-section">
            <h2>üîß Core Systems</h2>
            <div id="core-systems"></div>
        </div>

        <div class="test-section">
            <h2>üéØ Game Features</h2>
            <div id="game-features"></div>
        </div>

        <div class="test-section">
            <h2>üíæ Save/Load System</h2>
            <div id="save-system"></div>
        </div>

        <div class="test-section">
            <h2>üñºÔ∏è UI Components</h2>
            <div id="ui-components"></div>
        </div>

        <div class="test-section">
            <h2>‚ö° Performance</h2>
            <div id="performance"></div>
        </div>

        <div class="test-section">
            <h2>üéÆ Interactive Test</h2>
            <button onclick="runTests()">Run All Tests</button>
            <button onclick="testCharacterCreation()">Test Character Creation</button>
            <button onclick="testSaveLoad()">Test Save/Load</button>
            <button onclick="openGame()">Open Game</button>
        </div>

        <div class="summary">
            <h2>üìù Test Results Summary</h2>
            <div id="test-summary"></div>
        </div>
    </div>

    <script>
        let testResults = {
            passed: 0,
            failed: 0,
            warnings: 0,
            total: 0
        };

        function updateProgress() {
            const percentage = Math.round((testResults.passed / testResults.total) * 100) || 0;
            document.getElementById('overall-progress').style.width = percentage + '%';
            document.getElementById('progress-text').textContent = percentage + '%';

            document.getElementById('summary-stats').innerHTML = `
                <div class="test-result">
                    <span>Total Tests: ${testResults.total}</span>
                    <span class="success">Passed: ${testResults.passed}</span>
                    <span class="error">Failed: ${testResults.failed}</span>
                    <span class="warning">Warnings: ${testResults.warnings}</span>
                </div>
            `;
        }

        function addTestResult(section, name, status, details = '') {
            const container = document.getElementById(section);
            const statusIcon = status === 'pass' ? '‚úÖ' : status === 'fail' ? '‚ùå' : '‚ö†Ô∏è';
            const statusClass = status === 'pass' ? 'success' : status === 'fail' ? 'error' : 'warning';

            const result = document.createElement('div');
            result.className = 'test-result';
            result.innerHTML = `
                <span><span class="status-icon">${statusIcon}</span> ${name}</span>
                <span class="${statusClass}">${details || status.toUpperCase()}</span>
            `;
            container.appendChild(result);

            testResults.total++;
            if (status === 'pass') testResults.passed++;
            else if (status === 'fail') testResults.failed++;
            else testResults.warnings++;

            updateProgress();
        }

        async function runTests() {
            // Reset results
            testResults = { passed: 0, failed: 0, warnings: 0, total: 0 };
            document.querySelectorAll('#core-systems, #game-features, #save-system, #ui-components, #performance').forEach(el => el.innerHTML = '');

            // Core Systems Tests
            addTestResult('core-systems', 'Game Object', window.game ? 'pass' : 'fail');
            addTestResult('core-systems', 'EventManager', window.EventManager ? 'pass' : 'fail');
            addTestResult('core-systems', 'GameState', window.GameState ? 'pass' : 'fail');
            addTestResult('core-systems', 'ModuleManager', window.ModuleManager ? 'pass' : 'fail');
            addTestResult('core-systems', 'ErrorManager', window.ErrorManager ? 'pass' : 'fail');
            addTestResult('core-systems', 'SaveManager', window.SaveManager ? 'pass' : 'fail');

            // Game Features Tests
            addTestResult('game-features', 'CraftingSystem', window.CraftingSystem ? 'pass' : 'fail');
            addTestResult('game-features', 'ShopManager', window.ShopManager ? 'pass' : 'fail');
            addTestResult('game-features', 'Combat System', window.CombatSystem ? 'pass' : 'warning', 'Not loaded');
            addTestResult('game-features', 'Cultivation System', window.CultivationSystem ? 'pass' : 'warning', 'Not loaded');
            addTestResult('game-features', 'Skill System', window.SkillSystem ? 'pass' : 'warning', 'Not loaded');

            // Save System Tests
            const hasLocalStorage = typeof localStorage !== 'undefined';
            addTestResult('save-system', 'LocalStorage Available', hasLocalStorage ? 'pass' : 'fail');

            if (hasLocalStorage) {
                const saveData = localStorage.getItem('idleGameSave');
                addTestResult('save-system', 'Save Data Exists', saveData ? 'pass' : 'warning', 'No save found');

                if (saveData) {
                    try {
                        JSON.parse(saveData);
                        addTestResult('save-system', 'Save Data Valid', 'pass', 'Valid JSON');
                    } catch (e) {
                        addTestResult('save-system', 'Save Data Valid', 'fail', 'Invalid JSON');
                    }
                }
            }

            // UI Components Tests
            addTestResult('ui-components', 'Game Container', document.getElementById('game-container') ? 'pass' : 'fail');
            addTestResult('ui-components', 'Game View', document.getElementById('gameView') ? 'pass' : 'fail');
            addTestResult('ui-components', 'ViewManager', window.ViewManager ? 'pass' : 'fail');
            addTestResult('ui-components', 'GameView Class', window.GameView ? 'pass' : 'fail');
            addTestResult('ui-components', 'MainMenuView', window.MainMenuView ? 'pass' : 'fail');

            // Performance Tests
            const memory = performance.memory;
            if (memory) {
                const usedMB = Math.round(memory.usedJSHeapSize / 1024 / 1024);
                const limitMB = Math.round(memory.jsHeapSizeLimit / 1024 / 1024);
                addTestResult('performance', 'Memory Usage', usedMB < 100 ? 'pass' : 'warning', `${usedMB}MB / ${limitMB}MB`);
            }

            // Update summary
            updateTestSummary();
        }

        function updateTestSummary() {
            const summary = document.getElementById('test-summary');
            const passRate = Math.round((testResults.passed / testResults.total) * 100) || 0;

            let status = 'error';
            let message = 'Game has critical issues';

            if (passRate >= 90) {
                status = 'success';
                message = 'Game is ready for play!';
            } else if (passRate >= 70) {
                status = 'warning';
                message = 'Game is functional but needs improvements';
            } else if (passRate >= 50) {
                status = 'warning';
                message = 'Game has significant issues';
            }

            summary.innerHTML = `
                <h3 class="${status}">${message}</h3>
                <div class="test-result">
                    <span>Success Rate: ${passRate}%</span>
                    <span>Tests Passed: ${testResults.passed}/${testResults.total}</span>
                </div>
                <div style="margin-top: 20px;">
                    <h4>Key Findings:</h4>
                    <ul>
                        <li>Core systems: ${window.game ? '‚úÖ Initialized' : '‚ùå Not initialized'}</li>
                        <li>Save system: ${window.SaveManager ? '‚úÖ Available' : '‚ùå Not available'}</li>
                        <li>UI framework: ${window.ViewManager ? '‚úÖ Ready' : '‚ùå Not ready'}</li>
                        <li>Game mechanics: ${window.CraftingSystem && window.ShopManager ? '‚úÖ Loaded' : '‚ö†Ô∏è Partially loaded'}</li>
                    </ul>
                </div>
            `;
        }

        function testCharacterCreation() {
            if (window.characterCreation) {
                window.characterCreation.showModal();
                alert('Character creation modal triggered');
            } else {
                alert('Character creation not available');
            }
        }

        function testSaveLoad() {
            if (window.saveManager) {
                const testData = { test: true, timestamp: Date.now() };
                window.saveManager.save('test', testData);
                const loaded = window.saveManager.load('test');
                if (loaded) {
                    alert('Save/Load test successful!');
                } else {
                    alert('Save/Load test failed');
                }
            } else {
                alert('SaveManager not available');
            }
        }

        function openGame() {
            window.open('index.html', '_blank');
        }

        // Run tests on page load
        window.addEventListener('load', () => {
            setTimeout(runTests, 1000);
        });
    </script>
</body>
</html>