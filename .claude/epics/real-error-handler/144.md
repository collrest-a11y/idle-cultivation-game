# Task 144: Error Classification System

## Metadata
```yaml
created: 2025-09-26T13:56:25Z
priority: high
size: M
estimated_hours: 14
dependencies: [143]
parallel: true
status: pending
```

## Overview
Create a comprehensive error classification system that categorizes errors by severity, system, and recovery strategy. This enables intelligent error handling decisions and provides detailed analytics for system reliability monitoring.

## Acceptance Criteria

### 1. ErrorClassifier.js Implementation (MUST)
- [ ] Create ErrorClassifier.js with intelligent error categorization:
  - [ ] Severity levels: CRITICAL, HIGH, MEDIUM, LOW, INFO
  - [ ] System categories: CORE, SAVE, PROGRESSION, UI, NETWORK, MEMORY
  - [ ] Recovery strategies: IMMEDIATE, RETRY, FALLBACK, RESTART, IGNORE
- [ ] Implement machine learning-style pattern matching for error classification
- [ ] Support custom classification rules and rule priorities
- [ ] Provide classification confidence scores (0-100%)

### 2. Game-Specific Error Patterns (MUST)
- [ ] Define comprehensive error patterns for cultivation game:
  - [ ] **Save System Errors**:
    - [ ] Corruption detection patterns
    - [ ] Storage quota exceeded patterns
    - [ ] Version mismatch patterns
  - [ ] **Progression System Errors**:
    - [ ] CP calculation overflow patterns
    - [ ] Cultivation stage transition errors
    - [ ] Resource generation failures
  - [ ] **UI System Errors**:
    - [ ] Render loop failures
    - [ ] DOM manipulation errors
    - [ ] Animation system failures
  - [ ] **Performance Errors**:
    - [ ] Memory leak patterns
    - [ ] CPU spike detection
    - [ ] Frame rate degradation

### 3. Dynamic Classification Learning (MUST)
- [ ] Implement pattern learning from error frequency and context:
  - [ ] Track error patterns and their successful recovery strategies
  - [ ] Adjust classification confidence based on historical success rates
  - [ ] Identify new error patterns not in the predefined set
- [ ] Export/import classification rules for consistency across sessions
- [ ] Provide classification analytics and insights

### 4. Integration with Error Recovery (MUST)
- [ ] Seamlessly integrate with GameErrorHandler from Task 143
- [ ] Automatic classification of all errors before recovery attempts
- [ ] Classification-based recovery strategy selection
- [ ] Override mechanisms for manual classification corrections

### 5. Performance and Reliability (MUST)
- [ ] Classification completes in <1ms for 95% of errors
- [ ] Memory usage <512KB for classification system
- [ ] Graceful handling of classification system failures
- [ ] Thread-safe classification operations

## Implementation Details

### Files to Create/Modify
1. **Create**: `js/core/ErrorClassifier.js` - Main classification engine
2. **Create**: `js/core/ErrorPatterns.js` - Predefined error patterns
3. **Create**: `js/core/ClassificationRules.js` - Classification rule engine
4. **Modify**: `js/core/GameErrorHandler.js` - Integrate classification
5. **Create**: `tests/errorClassification.test.js` - Comprehensive test suite

### Core Classification Algorithm
```javascript
class ErrorClassifier {
  classify(error, context = {}) {
    const patterns = this.matchPatterns(error, context);
    const confidence = this.calculateConfidence(patterns);
    const category = this.categorizeError(patterns, confidence);

    return {
      severity: category.severity,
      system: category.system,
      strategy: category.strategy,
      confidence: confidence,
      patterns: patterns,
      timestamp: Date.now()
    };
  }
}
```

### Pattern Matching System
- **Stack Trace Analysis**: Parse and match stack trace patterns
- **Message Pattern Matching**: Regex and fuzzy matching on error messages
- **Context-Aware Classification**: Use game state and timing for context
- **Historical Pattern Learning**: Improve classification over time

### Classification Output Schema
```javascript
{
  severity: 'CRITICAL' | 'HIGH' | 'MEDIUM' | 'LOW' | 'INFO',
  system: 'CORE' | 'SAVE' | 'PROGRESSION' | 'UI' | 'NETWORK' | 'MEMORY',
  strategy: 'IMMEDIATE' | 'RETRY' | 'FALLBACK' | 'RESTART' | 'IGNORE',
  confidence: 0-100,
  patterns: [...matchedPatterns],
  metadata: {
    isKnownError: boolean,
    similarErrorCount: number,
    lastOccurrence: timestamp,
    recoverySuccessRate: 0-100
  }
}
```

## Testing Strategy

### Playwright MCP Tests
1. **Pattern Matching Tests**: Verify correct classification of known error types
2. **Performance Tests**: Measure classification speed under load
3. **Learning Tests**: Validate pattern learning and confidence adjustment
4. **Integration Tests**: Test classification within full error recovery flow
5. **Edge Case Tests**: Handle malformed errors and unusual contexts

### Error Injection Scenarios
1. Simulate save corruption with various patterns
2. Generate progression calculation errors
3. Trigger UI rendering failures
4. Create memory pressure scenarios
5. Network timeout and connection errors

### Classification Accuracy Tests
- Minimum 90% accuracy on known error patterns
- Maximum 5% false positive rate for critical errors
- Confidence scores correlate with actual classification accuracy
- New pattern detection within 3 occurrences

## Success Metrics
- Classification accuracy >90% on test error corpus
- Classification speed <1ms for 95% of errors
- Memory usage remains under 512KB
- Integration causes zero performance degradation
- Successfully classifies 100% of errors without system failure

## Dependencies
- **Task 143**: Requires GameErrorHandler integration to be complete
- ErrorRecovery.js system must be functional

## Parallel Execution
- Can be developed in parallel with Tasks 145 and 146
- Shares integration points with Task 143 completion

## Notes
- Create ACTUAL working implementations using Write/MultiEdit tools
- Focus on real pattern matching algorithms, not placeholder code
- Test extensively with Playwright MCP in real browser environment
- Ensure classification system is itself fault-tolerant
- Pattern definitions should be easily maintainable and extensible
