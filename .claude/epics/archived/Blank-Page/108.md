---
name: Create Safe Mode
status: completed
created: 2025-09-23T03:54:42Z
updated: 2025-09-23T12:40:48Z
github: https://github.com/collrest-a11y/idle-cultivation-game/issues/108
depends_on: [105, 107]
parallel: false
conflicts_with: [110]
---

# Task: Create Safe Mode

## Description
Implement minimal game mode that activates when normal initialization fails. Provides basic UI with core gameplay only, automatically triggered after multiple initialization failures. Ensures players can always access essential game functions.

## Acceptance Criteria
- [x] Safe mode triggers after 3 consecutive initialization failures
- [x] Minimal UI loads with core gameplay elements only
- [x] Basic save/load functionality available in safe mode
- [x] Clear indication to user that safe mode is active
- [x] Option to attempt normal mode restart from safe mode
- [x] Essential game progression still possible

## Technical Details
Implementation approach creates a lightweight fallback system with minimal dependencies.

- Files to modify:
  - src/core/SafeMode.js (new)
  - src/ui/SafeModeUI.js (new)
  - src/core/GameInitializer.js
  - src/managers/ModuleManager.js
- Key changes:
  - Create safe mode initialization pipeline
  - Build minimal UI with essential features only
  - Add failure counter and trigger logic
  - Implement safe mode state management

## Dependencies
- [ ] Task 105 (Module Loading) - Need stable module loading foundation
- [ ] Task 107 (State Validation) - Need save validation for safe mode

## Effort Estimate
- Size: M
- Hours: 3-5 hours
- Parallel: false

## Definition of Done
- [x] Code implemented
- [ ] Tests written and passing
- [x] Documentation updated
- [ ] Code reviewed
- [ ] Deployed to staging

## Implementation Summary

Successfully implemented Safe Mode system for the Blank-Page epic:

### Files Created:
1. **js/core/SafeMode.js** - Core safe mode logic with:
   - Failure detection and tracking (triggers after 3 failures)
   - Minimal game state management
   - Safe mode game loop for basic cultivation
   - Auto-save/load for safe mode state
   - Recovery attempt management
   - Emergency fallback UI

2. **js/ui/SafeModeUI.js** - Safe mode user interface with:
   - Clear safe mode banner indicating status
   - Basic cultivation progress display
   - Resource tracking (Qi Energy, Spirit Stones)
   - Meditation action for gameplay
   - Recovery options (Retry Normal Mode, Clear Save, Export State)
   - Failure history display
   - Responsive design with mobile support

### Files Modified:
1. **js/main.js** - Game initialization:
   - Added failure tracking on initialization errors
   - Triggers safe mode after 3 consecutive failures
   - Resets failure count on successful initialization
   - Added _activateSafeMode() method
   - Properly hides main game UI when safe mode activates

2. **index.html** - Script loading:
   - Added SafeMode.js to core scripts
   - Added SafeModeUI.js to UI scripts

### Key Features:
- **Automatic Activation**: Safe mode triggers after 3 consecutive initialization failures
- **Minimal Dependencies**: Uses only basic JavaScript, no complex game systems required
- **Playable Experience**: Basic cultivation with level progression and resource generation
- **Recovery Options**:
  - Retry normal mode (with attempt limits)
  - Clear all data and restart
  - Export safe mode state
- **Emergency Fallback**: If even safe mode fails, shows emergency recovery UI
- **Persistence**: Safe mode state is saved to localStorage
- **User Feedback**: Clear visual indicators that safe mode is active

### How It Works:
1. Normal game initialization fails and error is caught
2. SafeMode.recordFailure() increments failure counter
3. After 3 failures, safe mode is triggered
4. Main game UI is hidden, safe mode UI is shown
5. Minimal game loop runs with basic cultivation
6. User can attempt recovery or continue playing in safe mode
7. On successful normal mode restart, failure count is reset
